<!doctype html>
<html>

<head>
  <meta name="google-site-verification" content="v0cs50DFoPavKfRuxbFauBUTL7i_y_9vGlvFIpzzs7Q" />
  <style type="text/css">
    body {
      margin: 0;
      overflow: hidden;
      height: 100vh;
      width: 100%;
      background-color: black;
    }

    iframe {
      border: 0;
      width: 100%;
      height: calc(100% - 60px);
    }
  </style>
</head>

<body><iframe id="iframe"></iframe>
  <iframe id="iframe"></iframe>
<button onclick="newThingy(chapter - 1)" id="back">back</button>
<button onclick="newThingy()" id="next">next</button>
<input id="chapter" type="number" onchange="newThingy(this.value)">
<input id="textColor" type="number" onchange="changeColor('textColor', this.value)">
<input id="backgroundColor" type="number" onchange="changeColor('backgroundColor', this.value)">

  <script type="text/javascript">
    document.body.style.backgroundColor = localStorage.getItem("backgroundColor")
    async function fetchExternalHtml(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return await response.text(); // Return the text directly
  } catch (error) {
    console.error('Fetch error:', error);
  }
}
const backButton = document.getElementById("back")
const nextButton = document.getElementById("next")
let chapter = 0
function newThingy(ch) {
  if (chapter == 0 && localStorage.getItem("chapter")) {
    chapter = localStorage.getItem("chapter")
  } else {

    if (ch) {
      chapter = ch
    } else {

      chapter++
    }
  }
  if (chapter == 1) {
    backButton.disabled = true
  } else {
    backButton.disabled = false
  }
  localStorage.setItem("chapter", chapter)
  const input = document.getElementById("chapter")
  input.value = chapter
  fetchExternalHtml('https://novelhi.com/s/Spare-Me-Great-Lord/' + chapter)
    .then((htmlContent) => {
      if (htmlContent) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');

        const paragraphs = Array.from(doc.querySelectorAll("sent"))
          .map(p => p.innerText)
          .join("\n\n");

        const textColor = localStorage.getItem("textColor")
        const backgroundColor = localStorage.getItem("backgroundColor")
        const iframe = document.getElementById("iframe");
        iframe.srcdoc = paragraphs + `<style>body { background-color: ${backgroundColor||"black"}; color: ${textColor||"white"}; white-space: pre-wrap; font-family: sans-serif; }</style>`;
      }
    });
}
newThingy()
window.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft') {
    backButton.click()
  }
  if (e.key === 'ArrowRight') {
    nextButton.click()
  }
})

function changeColor(type, value) {
  localStorage.setItem(type, value)
  if (type == "backgroundColor") document.body.style.backgroundColor = value
}
  </script>
</body>
<html>

